name: Run Tests
on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses:  actions/setup-node@v3
        with:
          node-version: ${{ vars.NODE_VERSION }}
      - name: Set environment variables
        run: |
          git clone https://oauth2:$TOKEN_GITHUB@github.com/kalisio/development.git "development"
          source development/workspaces/libs/libs.sh feathers-webpush
          printenv
        env:
          TOKEN_GITHUB: ${{ vars.TOKEN_GITHUB }}
      - name: Install dependencies
        run: yarn
      - name: Run tests
        run: yarn test
  coverage:
    needs: test
    name: coverage
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-node@master
      with:
        node-version: '16'
    - run: npm install -g yarn
    - run: yarn install
    - run: yarn build
    - uses: paambaati/codeclimate-action@v2.2.4
      env:
        CC_TEST_REPORTER_ID: 8e87a996279373f05f01ce8166aac1bc9dda990e9a2f936af25e5aa11326b127
      with:
        coverageCommand: yarn coverage